---
title: Session and User Context
description: Tag traces with session and user IDs for multi-user applications.
---

<h1 className="mt-4 text-3xl font-medium">
  <span className="text-primary">Session and User Context</span>
</h1>
<h3 className="-mt-7 text-lg font-normal text-muted-foreground">
  Tag traces with session and user IDs for multi-user applications
</h3>

When building multi-user applications, you often need to track which user or session triggered each agent execution. Peargent provides context functions that automatically tag all traces with session and user IDs using **thread-local storage**.

## Context API

Use these functions to manage context for the current thread:

```python
from peargent.observability import ( 
    set_session_id, get_session_id,
    set_user_id, get_user_id,
    clear_context
)

# Set context
set_session_id("session_123") # [!code highlight]
set_user_id("user_456") # [!code highlight]

# Get context
print(f"Session: {get_session_id()}") # [!code highlight]
print(f"User: {get_user_id()}") # [!code highlight]

# Clear context (important for thread reuse)
clear_context()
```

## Web Application Integration

### Flask Middleware

Automatically set context from request headers or session:

```python
@app.before_request
def before_request():
    set_session_id(session.get('session_id'))
    set_user_id(request.headers.get('X-User-ID'))

@app.after_request
def after_request(response):
    clear_context()
    return response
```

### FastAPI Middleware

Use middleware to handle context for async requests:

```python
@app.middleware("http")
async def add_context(request: Request, call_next):
    set_session_id(request.headers.get("X-Session-ID"))
    set_user_id(request.headers.get("X-User-ID"))

    response = await call_next(request)
    
    clear_context()
    return response
```

## Filtering by Context

Once tagged, you can filter traces by session or user:

```python
# Filter by session
session_traces = tracer.list_traces(session_id="session_123") # [!code highlight]

# Filter by user
user_traces = tracer.list_traces(user_id="alice") # [!code highlight]
```

## What's Next?

**<u>[Accessing Traces](/docs/tracing-and-observability/accessing-traces)</u>**
Learn how to retrieve, filter, and analyze your trace data programmatically.
